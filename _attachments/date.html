<!DOCTYPE html>
<html>
  <head>
    <script src="vendor/couchapp/loader.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.0/jquery-ui.min.js"></script>
    <script src="vendor/couchapp/jquery.tablesorter.min.js"></script>
    <script src="lobbying.js"></script>
    <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.8.2r1/build/reset/reset-min.css">
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="style/main.css" type="text/css">
    <title>Browse Lobbyist Spending by Date</title>
    <!--[if IE]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
<style>
    #months { margin-left: 1em; }
    #months td { padding-right: 1em; }
    #months .value { width: 200px; }
    .start { border-top: 2px solid black; }
    .bar { background-color: #7CD3B5; }
</style>
  </head>
  <body>
<h1>Lobbyist Spending by Month</h1>
<table id="months" class="tablesorter">
    <thead><tr><th>Month</th><th>Amount</th></tr></thead>
    <tbody></tbody>
</table>

  </body>
  <script>

$db = $.couch.db("lobbying");
var key_data_cache = {};

(function load_data(){
    log("Load Keys");
    $db.view("lobbying/month-to-amount", {
        group_level: 1,
        success: function(jsonData){
            var keys = $('#months > tbody');
            jsonData.rows.forEach(function(row){
                var year = +row.key.substr(0,3) + 1900;
                var month = +row.key.substr(3) + 1;
                elem = $('<tr' + (month == 1 ? ' class="start"' : '')  + '><td class="date">' + year + '/' + month + '</td><td class="value">' + row.value + '</td></tr>')
                    .appendTo(keys);
            });
            $('#months').tablesorter().tablebars();
        }
    });
})();


  </script>
</html>
